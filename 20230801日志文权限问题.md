### 20230801日志文权限问题

原因分析：

​	——使用宝塔面板执行定时任务，宝塔面板定时任务默认执行用户为root

​	——php think 方法执行命令，如果开启日志，那么默认将按月创建日志文件夹，文件夹所有者为当前执行的用户

  月初系统执行定时任务，使用root用户执行导致生成的日志文件夹所有者为root，网页请求时，用户为www，权限低于root，写入日志文件时被系统拒绝



![](https://hanhan-1252807418.cos.ap-chengdu.myqcloud.com//picgo%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230801085657.png)



临时修复方案：手动修改此文件夹所有者为www；宝塔面板可以直接右键 ->更多->权限->修改所有者

修改方案：定时任务脚本增加命令

```shell
su -s /bin/bash - www <<EOF
cd /www/wwwroot/api.nft-bonus.net/
php think ......
EOF
```

```
命令解析：
su -s /bin/bash - www <<EOF
编写你的命令，支持换行
EOF

使用www用户执行下面的命令.可以记录下，常用
```

 

可以尝试一下，先删除本月的日志文件夹，然后在宝塔面板执行定时任务，看下指定执行用户和不指定生成的日志文件所有者。

PS：如果开启文件缓存，需要也检查下缓存文件是否有对应的读写权限

参考文档：[宝塔定时任务指定用户](http://mrcdh.cn/pages/d87cd4/#%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E6%89%A7%E8%A1%8C%E6%8C%87%E4%BB%A4)





